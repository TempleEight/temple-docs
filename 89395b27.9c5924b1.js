(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{155:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return c}));var a=n(1),r=(n(0),n(176));const i={id:"value-annotations",title:"Value Annotations",sidebar_label:"Value Annotations"},o={id:"guide/value-annotations",title:"Value Annotations",description:"In addition to restricting individual values with primitive parameters, Temple supports adding service-level constraints with annotations.",source:"@site/docs/guide/value-annotations.md",permalink:"/temple-docs/docs/guide/value-annotations",editUrl:"https://github.com/TempleEight/temple-docs/edit/master/TempleEight/docs/guide/value-annotations.md",sidebar_label:"Value Annotations",sidebar:"docsSidebar",previous:{title:"Temple Test",permalink:"/temple-docs/docs/guide/temple-test"},next:{title:"Value Constraints",permalink:"/temple-docs/docs/guide/value-constraints"}},l=[{value:"Unique",id:"unique",children:[]},{value:"Server",id:"server",children:[]},{value:"ServerSet",id:"serverset",children:[]},{value:"Client",id:"client",children:[]},{value:"Summary",id:"summary",children:[]}],b={rightToc:l};function c({components:e,...t}){return Object(r.b)("wrapper",Object(a.a)({},b,t,{components:e,mdxType:"MDXLayout"}),Object(r.b)("p",null,"In addition to restricting individual values with primitive parameters, Temple supports adding service-level constraints with annotations.\nWe'll start by considering the ",Object(r.b)("inlineCode",{parentName:"p"},"ExampleService")," from the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../getting-started"}),"Getting Started")," guide:"),Object(r.b)("h2",{id:"unique"},"Unique"),Object(r.b)("p",null,"By adding a ",Object(r.b)("inlineCode",{parentName:"p"},"@unique")," annotation to a property, at most one object stored by the service may have a particular value stored for that property.\nFor example adding a unique annotation to the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute means that every entity stored must have store a diffferent value."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-templefile"}),"ExampleService: service {\n  foo: string;\n  bar: int @unique;\n}\n")),Object(r.b)("p",null,"Let's see an example of this, by attempting to create an object with the same value of ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," twice:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'\u276f\u276f\u276f curl -X POST $KONG_ENTRY/api/example-service -d \'{"foo": "value!", "bar": 10}\'\n{"id":"e24e6d58-83e7-11ea-b435-0242ac1d0003","foo":"value!","bar":10}\n\n\u276f\u276f\u276f curl -X POST $KONG_ENTRY/api/example-service -d \'{"foo": "another value!", "bar": 10}\'\n{"error":"Duplicate ExampleService found"}\n')),Object(r.b)("p",null,"One special use of the ",Object(r.b)("inlineCode",{parentName:"p"},"@unique")," attribute comes when combined with property-level ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"value-constraints"}),"Value Constraints"),", which allows you to limit the total number of ",Object(r.b)("inlineCode",{parentName:"p"},"ExampleService")," objects that could exist at any one time.\nFor example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-templefile"}),"ExampleService: service {\n  foo: string;\n  bar: int(100, 1) @unique;\n}\n")),Object(r.b)("p",null,"As there are only 100 possible values for the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," property and each one must be unique, there can only ever be at most 100 total ",Object(r.b)("inlineCode",{parentName:"p"},"ExampleService")," objects."),Object(r.b)("h2",{id:"server"},"Server"),Object(r.b)("p",null,"Annotating a property with ",Object(r.b)("inlineCode",{parentName:"p"},"@server")," allows you to indicate that a property will not be provided by a client, nor will it be returned in responses to the client, but it is still stored by the datastore.\nThis might be particularly useful if you want to store some data for server-side computation only, without giving this information back to the client."),Object(r.b)("p",null,"For example, let's add a ",Object(r.b)("inlineCode",{parentName:"p"},"@server")," property to the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-templefile"}),"ExampleService: service {\n  foo: string;\n  bar: int @server;\n}\n")),Object(r.b)("p",null,"Now, when we make requests, we don't have to include the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute, nor is it returned in the response:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'\u276f\u276f\u276f curl -X POST $KONG_ENTRY/api/example-service -d \'{"foo": "value!"}\'\n{"id":"0906da4f-8958-11ea-b3bd-0242c0a87003","foo":"value!"}\n')),Object(r.b)("p",null,"You may wonder how you can set the value of ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," before it is stored in the datastore.\nTo do this, you'll need to define a new hook for the ",Object(r.b)("inlineCode",{parentName:"p"},"Create")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Update")," endpoints.\nInformation about how to do this can be found in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"hooks"}),"Hooks")," guide."),Object(r.b)("h2",{id:"serverset"},"ServerSet"),Object(r.b)("p",null,"Annotating a property with ",Object(r.b)("inlineCode",{parentName:"p"},"@serverSet")," allows you to indicate that the property will not be provided by a client, but it will be returned in response and stored in the data store.\nThis might be particularly useful if you want to do some server side computation before setting the value."),Object(r.b)("p",null,"For example, let's add a ",Object(r.b)("inlineCode",{parentName:"p"},"@serverSet")," property to the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-templefile"}),"ExampleService: service {\n  foo: string;\n  bar: int @serverSet;\n}\n")),Object(r.b)("p",null,"Now, when we make requests, we don't have to include the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute, but a value is returned in the response:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'\u276f\u276f\u276f curl -X POST $KONG_ENTRY/api/example-service -d \'{"foo": "value!"}\'\n{"id":"ac98a3b1-8958-11ea-9cc0-0242c0a88004","foo":"value!","bar":0}\n')),Object(r.b)("p",null,"You may wonder how you can set the value of ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," before it is stored in the datastore.\nTo do this, you'll need to define a new hook for the ",Object(r.b)("inlineCode",{parentName:"p"},"Create")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Update")," endpoints.\nInformation about how to do this can be found in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"hooks"}),"Hooks")," guide."),Object(r.b)("h2",{id:"client"},"Client"),Object(r.b)("p",null,"Annotating a property with ",Object(r.b)("inlineCode",{parentName:"p"},"@client")," allows you to indicate that the property will be provided by the client, but it will not be included in the response, nor will it be stored.\nThis might be particularly useful if you want to do some server side computation, but don't need the value afterwards."),Object(r.b)("p",null,"For example, let's add a ",Object(r.b)("inlineCode",{parentName:"p"},"@client")," property to the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-templefile"}),"ExampleService: service {\n  foo: string;\n  bar: int @client;\n}\n")),Object(r.b)("p",null,"Now, when we make requests, we have to include the ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," attribute, but it will not be returned in the response, nor in any subsequent ",Object(r.b)("inlineCode",{parentName:"p"},"READ")," requests:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'\u276f\u276f\u276f curl -X POST $KONG_ENTRY/api/example-service -d \'{"foo": "value!", "bar": 123}\'\n{"id":"2ef1876f-8959-11ea-9bac-0242c0a88003","foo":"value!"}\n\n\u276f\u276f\u276f curl -X GET $KONG_ENTRY/api/example-service/2ef1876f-8959-11ea-9bac-0242c0a88003\n{"id":"2ef1876f-8959-11ea-9bac-0242c0a88003","foo":"value!"}\n')),Object(r.b)("p",null,"You may wonder how you can use the value of ",Object(r.b)("inlineCode",{parentName:"p"},"bar")," during the request.\nTo do this, you'll need to define a new hook for the ",Object(r.b)("inlineCode",{parentName:"p"},"Create")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Update")," endpoints.\nInformation about how to do this can be found in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"hooks"}),"Hooks")," guide."),Object(r.b)("h2",{id:"summary"},"Summary"),Object(r.b)("p",null,"In summary, we have presented a series of annotations which allow you to vary the contents of requests and responses, depending on your specific use case.\nA table summarising the usage of each annotation is given below:"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null})),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Request"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Response"),Object(r.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"DAO"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"@server")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"N"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"N"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Y")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"@serverSet")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"N"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Y"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Y")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(r.b)("inlineCode",{parentName:"td"},"@client")),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Y"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"N"),Object(r.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"N")))))}c.isMDXComponent=!0},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l({},t,{},e)),n},u=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,c=b(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,m=u["".concat(o,".").concat(d)]||u[d]||s[d]||i;return n?r.a.createElement(m,l({ref:t},c,{components:n})):r.a.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var b in t)hasOwnProperty.call(t,b)&&(l[b]=t[b]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);