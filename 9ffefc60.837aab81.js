(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{149:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return d})),t.d(n,"default",(function(){return s}));var o=t(1),r=t(9),a=(t(0),t(164)),i={id:"adding-endpoints",title:"Adding Endpoints",sidebar_label:"Adding Endpoints"},c={id:"guide/adding-endpoints",title:"Adding Endpoints",description:"As with all services, you're eventually going to want to add more functionality than the basic CRUD endpoints we generate for you.",source:"@site/docs/guide/adding-endpoints.md",permalink:"/temple-docs/docs/guide/adding-endpoints",editUrl:"https://github.com/TempleEight/temple-docs/edit/master/TempleEight/docs/guide/adding-endpoints.md",sidebar_label:"Adding Endpoints",sidebar:"docsSidebar",previous:{title:"Business Logic & Hooks",permalink:"/temple-docs/docs/guide/hooks"},next:{title:"Adding DAO Functions",permalink:"/temple-docs/docs/guide/adding-dao-functions"}},d=[{value:"Customising Your Service",id:"customising-your-service",children:[]},{value:"Adding New Endpoints",id:"adding-new-endpoints",children:[]}],l={rightToc:d};function s(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"As with all services, you're eventually going to want to add more functionality than the basic CRUD endpoints we generate for you.\nSo that you don't have to rewrite entire sections of your application, we've made it easy to add new endpoints to your service, with full access to any functions we've predefined for you."),Object(a.b)("p",null,"This short guide will walk you through how to add addtional endpoints to your application, using the ",Object(a.b)("inlineCode",{parentName:"p"},"ExampleProject")," from the ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"getting-started"}),"getting started guide"),".\nWe'll also assume you have a fairly good understanding of the Go language."),Object(a.b)("h2",{id:"customising-your-service"},"Customising Your Service"),Object(a.b)("p",null,"In the ",Object(a.b)("inlineCode",{parentName:"p"},"example-service")," directory, you'll find the following files and folders:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"example-service\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 config.json\n\u251c\u2500\u2500 dao\n\u2502\xa0\xa0 \u251c\u2500\u2500 dao.go\n\u2502\xa0\xa0 \u251c\u2500\u2500 datastore.go\n\u2502\xa0\xa0 \u2514\u2500\u2500 errors.go\n\u251c\u2500\u2500 example-service.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 hook.go\n\u251c\u2500\u2500 setup.go\n\u2514\u2500\u2500 util\n    \u2514\u2500\u2500 util.go\n")),Object(a.b)("p",null,"We're most interested in ",Object(a.b)("inlineCode",{parentName:"p"},"setup.go")," for this guide, which is where you can add additional logic that won't be lost if you need to regenerate your Templefile (see the ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"regeneration"}),"Regeneration")," guide for more on this)."),Object(a.b)("p",null,"This file will start off looking fairly empty:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-go"}),'package main\n\nimport "github.com/gorilla/mux"\n\nfunc (env *env) setup(router *mux.Router) {\n    // Add user defined code here\n}\n')),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"setup")," method defined on ",Object(a.b)("inlineCode",{parentName:"p"},"env")," is invoked before the HTTP server is started.\nThis means you can:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"register hooks, to be executed before or after any database calls (see the ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"hooks"}),"hooks")," guide for more information)"),Object(a.b)("li",{parentName:"ul"},"add additional endpoints")),Object(a.b)("h2",{id:"adding-new-endpoints"},"Adding New Endpoints"),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"setup")," function in ",Object(a.b)("inlineCode",{parentName:"p"},"setup.go")," defines a function which takes a ",Object(a.b)("inlineCode",{parentName:"p"},"mux.Router")," as an argument.\nWhen we generate each endpoint, we register it with this router.\nFor more information about mux, check out ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"http://www.gorillatoolkit.org/pkg/mux"}),"their documentation"),"."),Object(a.b)("p",null,"You're able to take advantage of all of mux's features, including registering new endpoints."),Object(a.b)("p",null,"We'll start off by adding a new route, and defining a handler for that route:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-go"}),'package main\n\nimport (\n    "net/http"\n\n    "github.com/gorilla/mux"\n)\n\nfunc (env *env) setup(router *mux.Router) {\n    router.HandleFunc("/example-service/{id}/custom-endpoint", env.CustomHandler).Methods(http.MethodGet)\n}\n\nfunc (env *env) CustomHandler(w http.ResponseWriter, r *http.Request) {\n\n}\n')),Object(a.b)("p",null,"The handler we define here follows type required by the ",Object(a.b)("inlineCode",{parentName:"p"},"mux.Router"),".\nOne important difference is that we define the handler on the ",Object(a.b)("inlineCode",{parentName:"p"},"env")," object.\nThis is so that we are able to access the DAO, Hooks as well as ",Object(a.b)("inlineCode",{parentName:"p"},"Comm"),", an object for providing inter-service communication, from inside the handler."),Object(a.b)("p",null,"Let's populate the handler with an error response, since we haven't quite decided what we want the handler to do yet:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-go",metastring:"{14}","{14}":!0}),'package main\n\nimport (\n    "net/http"\n\n    "github.com/gorilla/mux"\n)\n\nfunc (env *env) setup(router *mux.Router) {\n    router.HandleFunc("/example-service/{id}/custom-endpoint", env.CustomHandler).Methods(http.MethodGet)\n}\n\nfunc (env *env) CustomHandler(w http.ResponseWriter, r *http.Request) {\n    respondWithError(w, "TODO!", http.StatusTeapot)\n}\n')),Object(a.b)("p",null,"Let's now spin up our project and try some requests:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-bash"}),'\u276f\u276f\u276f source deploy.sh\n\n# Create a new entity\n\u276f\u276f\u276f curl -X POST $KONG_ENTRY/api/example-service -d \'{"foo": "hello", "bar": 123}\'\n{"id":"7bbe6302-8413-11ea-80e8-0242c0a83002","foo":"hello","bar":123}\n\n# Use the new endpoint\n\u276f\u276f\u276f curl -X GET $KONG_ENTRY/api/example-service/7bbe6302-8413-11ea-80e8-0242c0a83002/custom-endpoint\n{"error":"TODO!"}\n')))}s.isMDXComponent=!0},164:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var o=t(0),r=t.n(o);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),s=function(e){var n=r.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c({},n,{},e)),t},u=function(e){var n=s(e.components);return r.a.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},b=Object(o.forwardRef)((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=d(e,["components","mdxType","originalType","parentName"]),u=s(t),b=o,m=u["".concat(i,".").concat(b)]||u[b]||p[b]||a;return t?r.a.createElement(m,c({ref:n},l,{components:t})):r.a.createElement(m,c({ref:n},l))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=b;var c={};for(var d in n)hasOwnProperty.call(n,d)&&(c[d]=n[d]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var l=2;l<a;l++)i[l]=t[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);