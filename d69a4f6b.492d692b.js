(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{168:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return l}));var a=n(1),r=(n(0),n(176));const o={id:"adding-dao-functions",title:"Adding DAO Functions",sidebar_label:"Adding DAO Functions"},i={id:"guide/adding-dao-functions",title:"Adding DAO Functions",description:"The DAO provides an interface between a datastore and application code.",source:"@site/docs/guide/adding-dao-functions.md",permalink:"/temple-docs/docs/guide/adding-dao-functions",editUrl:"https://github.com/TempleEight/temple-docs/edit/master/TempleEight/docs/guide/adding-dao-functions.md",sidebar_label:"Adding DAO Functions",sidebar:"docsSidebar",previous:{title:"Access Control",permalink:"/temple-docs/docs/guide/access-control"},next:{title:"Adding Endpoints",permalink:"/temple-docs/docs/guide/adding-endpoints"}},c=[{value:"Adding a New DAO Function",id:"adding-a-new-dao-function",children:[]}],d={rightToc:c};function l({components:e,...t}){return Object(r.b)("wrapper",Object(a.a)({},d,t,{components:e,mdxType:"MDXLayout"}),Object(r.b)("p",null,"The DAO provides an interface between a datastore and application code.\nIts main objective is to decouple the actual datastore interactions and business logic such as validation or JSON encoding."),Object(r.b)("p",null,"As part of a ",Object(r.b)("inlineCode",{parentName:"p"},"Temple")," project, we generate a DAO for each service, so that regardless of datastore chosen, the handler logic will be the same.\nMore information on this can be found in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../arch/service"}),"Service Architecture"),"."),Object(r.b)("p",null,"Within the generated DAO you will find methods for performing the standard ",Object(r.b)("inlineCode",{parentName:"p"},"Create"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Read"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Update"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Delete"),", ",Object(r.b)("inlineCode",{parentName:"p"},"List")," or ",Object(r.b)("inlineCode",{parentName:"p"},"Identify")," endpoints.\nThese queries are very simple: they perform the minimum the query required to extract all the data stored within the system."),Object(r.b)("p",null,"There are times where these standard queries are not sufficient to perform the query you require, so we designed ",Object(r.b)("inlineCode",{parentName:"p"},"Temple")," to allow for additional DAO methods.\nThis guide will walk you through how to add new DAO functions to your project, using the ",Object(r.b)("inlineCode",{parentName:"p"},"ExampleService")," defined in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../getting-started"}),"Getting Started")," guide."),Object(r.b)("h2",{id:"adding-a-new-dao-function"},"Adding a New DAO Function"),Object(r.b)("p",null,"The Templefile we defined in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"../getting-started"}),"Getting Started")," guide was as follows:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-templefile"}),"ExampleProject: project {\n  #language(go);\n  #database(postgres);\n  #provider(dockerCompose);\n}\n\nExampleService: service {\n  foo: string;\n  bar: int;\n}\n")),Object(r.b)("p",null,"In the ",Object(r.b)("inlineCode",{parentName:"p"},"example-service/dao")," director, you will find 3 files:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"example-service/dao\n\u251c\u2500\u2500 dao.go\n\u251c\u2500\u2500 datastore.go\n\u2514\u2500\u2500 errors.go\n")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"dao.go")," contains the generate DAO functions.\nThis might be useful to use as a reference for how to write additional DAO functions.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"datastore.go")," contains an interface which you can modify with additional datastore methods.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"errors.go")," contains errors that can be returned from the DAO."))),Object(r.b)("p",null,"Opening up ",Object(r.b)("inlineCode",{parentName:"p"},"datastore.go"),", you'll find an empty interface called ",Object(r.b)("inlineCode",{parentName:"p"},"Datastore")," which extends the ",Object(r.b)("inlineCode",{parentName:"p"},"BaseDatastore")," defined in ",Object(r.b)("inlineCode",{parentName:"p"},"dao.go"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-go"}),"package dao\n\n// Datastore provides the interface adopted by the DAO, allowing for mocking\ntype Datastore interface {\n    BaseDatastore\n}\n")),Object(r.b)("p",null,"By adding a method to the interface, and then providing an implementation of that interface on the object DAO, it will be accessible from ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"hooks"}),"hooks")," as well as from ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"adding-endpoints"}),"additional endpoints")," that you define."),Object(r.b)("p",null,"For example, let's add a custom DAO method that will find the first row where ",Object(r.b)("inlineCode",{parentName:"p"},"bar = 5"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-go"}),'package dao\n\n// Datastore provides the interface adopted by the DAO, allowing for mocking\ntype Datastore interface {\n    BaseDatastore\n    ReadBar5() (*ExampleService, error)\n}\n\n// ReadBar5 returns the fist exampleService in the datastore where the value of foo is 5\nfunc (dao *DAO) ReadBar5() (*ExampleService, error) {\n    row := executeQueryWithRowResponse(dao.DB, "SELECT id, foo, bar FROM example_service WHERE bar = 5;")\n\n    var exampleService ExampleService\n    err := row.Scan(&exampleService.ID, &exampleService.Foo, &exampleService.Bar)\n    if err != nil {\n        return nil, err\n    }\n\n    return &exampleService, nil\n}\n')),Object(r.b)("p",null,"We're doing 4 key things here:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Defining the method in the interface"),Object(r.b)("li",{parentName:"ol"},"Defining the method on the object DAO, which is an implementation of the ",Object(r.b)("inlineCode",{parentName:"li"},"Datastore")," interface"),Object(r.b)("li",{parentName:"ol"},"Populating the body using utility methods defined in ",Object(r.b)("inlineCode",{parentName:"li"},"dao.go")),Object(r.b)("li",{parentName:"ol"},"Returning the response or error to the caller")),Object(r.b)("p",null,"Any code you add in this file will not be removed if you need to regenerate the Temple project based on some updates to your Templefile.\nHowever, this might mean that some of your custom queries may need to modified to deal with the addition, modification or removal of certain attributes."))}l.isMDXComponent=!0},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},s=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,l=d(e,["components","mdxType","originalType","parentName"]),s=p(n),u=a,m=s["".concat(i,".").concat(u)]||s[u]||b[u]||o;return n?r.a.createElement(m,c({ref:t},l,{components:n})):r.a.createElement(m,c({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var c={};for(var d in t)hasOwnProperty.call(t,d)&&(c[d]=t[d]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);