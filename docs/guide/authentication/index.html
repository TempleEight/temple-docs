<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Authentication</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Temple · Generate microservice systems at lightning speed"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:url" content="https://templeeight.github.io/temple-docs//temple-docs/docs/guide/authentication">

<link data-react-helmet="true" rel="shortcut icon" href="/temple-docs/img/favicon.ico">


<link rel="stylesheet" href="/temple-docs/styles.d71321c5.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/temple-docs/"><img class="navbar__logo" src="/temple-docs/img/temple.svg" alt="Temple Logo"><strong>Temple</strong></a><a class="navbar__item navbar__link" href="/temple-docs/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/TempleEight/temple">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/temple-docs/"><img class="navbar__logo" src="/temple-docs/img/temple.svg" alt="Temple Logo"><strong>Temple</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/TempleEight/temple">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/value-annotations">Value Annotations</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/temple-docs/docs/guide/authentication">Authentication</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/access-control">Access Control</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/foreign-keys">Foreign Keys &amp; Inter-Service Communication</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/omitting-endpoints">Omitting Endpoints</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/enumeration">Enumeration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/hooks">Business Logic &amp; Hooks</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/adding-endpoints">Adding Endpoints</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/adding-dao-functions">Adding DAO Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/orchestration">Orchestration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/temple-test">Temple Test</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/regeneration">Regeneration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/open-api">OpenAPI Generation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Generated Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/arch/system">System Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/arch/service">Service Architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/templefile-spec">Templefile Specification</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/templefile-primitives">Templefile Primitives</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Example Templefiles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/airbnb">Airbnb</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Authentication</h1></header><div class="markdown"><p>A crucial component of most systems is its authentication system, namely validating that the user of a system is who they claim to be.
At Temple, we baked this directly into the generated architecture, so that you don&#x27;t have to worry about getting the details right.
In this guide, we&#x27;ll show you how to add authentication to your project and how this affects the system architecture, using the example project from the <a href="../getting-started">Getting Started</a> guide.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="adding-authentication-to-your-project"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-authentication-to-your-project" title="Direct link to heading">#</a>Adding Authentication to Your Project</h2><p>The <a href="../getting-started">Getting Started</a> guide concluded with the following example Templefile:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExampleProject: project {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #language(go);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #database(postgres);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #provider(dockerCompose);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExampleService: service {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  foo: string;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bar: int;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>To add authentication to this, we need to add two things:</p><ol><li><strong>A project-level auth method metdata</strong></li></ol><ul><li>This indicates how users will log in. Currently we only support <code>email</code> authentication, but we will be expanding this in the future.</li></ul><ol start="2"><li><strong>A service-level auth metadata</strong></li></ol><ul><li>This indicates one or many services which store metadata about your users, in addition to their authentication details.</li></ul><p>We&#x27;re going to apply these two modifications to our example Templefile by introducing a new service called <code>ExampleUser</code>, which will additionally store the user&#x27;s name:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-templefile codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExampleProject: project {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #language(go);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #database(postgres);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #provider(dockerCompose);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  #authMethod(email);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">ExampleUser: service {</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  name: string;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  #auth;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExampleService: service {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  foo: string;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bar: int;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>That&#x27;s it - simple, right!
Under the hood, this makes lots of changes to your generated project so that:</p><ul><li>Users are required to login before accessing any service</li><li>Every service requires a valid authentication token</li><li>Created entities in each service are associated with a given user and access restricted appropriately. More information on this can be found in the <a href="access-control">Access Control</a> guide.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="testing-the-authentication-changes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing-the-authentication-changes" title="Direct link to heading">#</a>Testing the Authentication Changes</h2><p>Previously, our system architecture was set out as follows:</p><p align="center"><img alt="Tutorial System Architecture" src="/temple-docs/img/tutorial-architecture.png" width="75%"></p><p>However, now we have introduced the <code>ExampleUser</code> service, as well as an automatically generated <code>Auth</code> service:</p><p align="center"><img alt="Tutorial System Architecture with Authentication" src="/temple-docs/img/tutorial-auth-architecture.png" width="75%"></p>Let&#x27;s regenerate the project using `temple generate` as in the [Getting Started](../getting-started) guide, spin up the project and make some requests to the `ExampleService` service:<pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> deploy.sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;Hello&quot;, &quot;bar&quot;: 123}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;message&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Unauthorized&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Immediately we get a response back that the request is unauthorized.
To rectify this, we first need to register or login with the <code>Auth</code> service.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="registration-and-login"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#registration-and-login" title="Direct link to heading">#</a>Registration and Login</h2><p>The generated <code>Auth</code> service provides 2 endpoints: <code>register</code> and <code>login</code>.
Their names are fairly self explanatory, however let&#x27;s see some examples of them in action:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="registration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#registration" title="Direct link to heading">#</a>Registration</h3><p>The <code>register</code> endpoint requires a POST request with a JSON object containing an <code>email</code> and <code>password</code> key.
In response, it will return an access token that will be used to authenticate subsequent requests.
Note that we implicitly require the email address to be unique, such that one email address can only register once:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Initial registration</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/auth/register -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;email&quot;: &quot;hello@temple.com&quot;, &quot;password&quot;: &quot;abcdefgh&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AccessToken&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Subsequent registration</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/auth/register -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;email&quot;: &quot;hello@temple.com&quot;, &quot;password&quot;: &quot;abcdefgh&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;error&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;auth already exists&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="login"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#login" title="Direct link to heading">#</a>Login</h3><p>The <code>login</code> endpoint again requires a POST request with a JSON object containing an <code>email</code> and <code>password</code> key.
In response, it will also return an access token that will be used to authenticate subsequent requests.
If the email doesn&#x27;t exist, or the password is incorrect, an error will be returned.</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Auth exists and valid credentials provided</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/auth/login -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;email&quot;: &quot;hello@temple.com&quot;, &quot;password&quot;: &quot;abcdefgh&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AccessToken&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Auth exists, but password is invalid</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/auth/login -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;email&quot;: &quot;hello@temple.com&quot;, &quot;password&quot;: &quot;abcdefghijk&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;error&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Invalid email or password&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Auth doesn&#x27;t exist</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/auth/login -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;email&quot;: &quot;goodbye@temple.com&quot;, &quot;password&quot;: &quot;abcdefghijk&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;error&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Invalid email or password&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="authenticating-requests-to-other-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#authenticating-requests-to-other-services" title="Direct link to heading">#</a>Authenticating Requests to Other Services</h2><p>Now that we are able to obtain an access token, we can make requests to other services by including the auth token in the request headers.
We use the Bearer Token framework, as defined in <a href="https://tools.ietf.org/html/rfc6750">RFC6750</a>.</p><p>Let&#x27;s consider a full example of registration, followed by a request to <code>ExampleService</code>:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/auth/register -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;email&quot;: &quot;test@temple.com&quot;, &quot;password&quot;: &quot;abcdefgh&quot;}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AccessToken&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODgwMTI3OTAsImlkIjoiNGZmYjAyZDQtODdlZC0xMWVhLWE4NjktMDI0MmFjMWYwMDAzIiwiaXNzIjoiaDFNT3hwN2lhTFFOTFA4ek1RS3k2VEkzcmpuNTlsM2MifQ.xNcAdY0r98J7rzNeEWSUPDTUg5HXOCFh41ZB74tTSw0&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;hello&quot;, &quot;bar&quot;: 123}&#x27;</span><span class="token plain"> -H </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1ODgwMTI3OTAsImlkIjoiNGZmYjAyZDQtODdlZC0xMWVhLWE4NjktMDI0MmFjMWYwMDAzIiwiaXNzIjoiaDFNT3hwN2lhTFFOTFA4ek1RS3k2VEkzcmpuNTlsM2MifQ.xNcAdY0r98J7rzNeEWSUPDTUg5HXOCFh41ZB74tTSw0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;74045036-87ed-11ea-9edc-0242c0a81003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;hello&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Now we included a valid token in the Authorization header, the request was authorized and the entity successfully created.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="services-with-auth-metadata"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#services-with-auth-metadata" title="Direct link to heading">#</a>Services with <code>#auth</code> Metadata</h2><p>You may have noticed that so far we have ignored the <code>ExampleUser</code> service we previously defined.
That&#x27;s because it acts as any other service, so any example given in this guide could have been replace with a call to that service too.</p><p>However, it has one distinguishing feature: a single token is only able to create a single entity in this service.
This means means that there is at most a one-to-one mapping between an entity in the <code>Auth</code> service, and an entity in the <code>ExampleUser</code> service.
This makes the <code>ExampleUser</code> service perfect for storing additional metadata about a user, such as their name, address or anything that fits your business needs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="how-authentication-is-implemented"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-authentication-is-implemented" title="Direct link to heading">#</a>How Authentication is Implemented</h2><p>To best explain the changes made when authentication is added to your project let&#x27;s consider how a new user registers with your service:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="pre-request-preparation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pre-request-preparation" title="Direct link to heading">#</a>Pre-request Preparation</h4><p>Before any request is even issued to your <code>Auth</code> service, several steps are taken:</p><ul><li>The <code>Auth</code> service registers as a consumer with Kong (<a href="https://docs.konghq.com/2.0.x/getting-started/adding-consumers/#1-create-a-consumer-through-the-restful-api">see the Kong documentation</a>)</li><li>The <code>Auth</code> service requests a new HS256 JWT credential from Kong, used to sign each token</li><li>All other services, other than <code>Auth</code>, are configured through Kong to require a JWT as part of the request body</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="making-a-register-request"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#making-a-register-request" title="Direct link to heading">#</a>Making a Register Request</h4><p>Upon making a request to the <code>/register</code> endpoint, the service will:</p><ul><li>Validate the email and password<ul><li>We currently impose a minimum 8 character limit on the passwords, but you can extend these in your custom defined hooks - see the <a href="hooks">Hooks</a> guide for more.</li></ul></li><li>Validate that a user with that email address doesn&#x27;t already exist</li><li>Hash and salt the password using <a href="https://godoc.org/golang.org/x/crypto/bcrypt">bcrypt</a></li><li>Generate a UUID for that user, according to UUID version 1 of <a href="https://tools.ietf.org/html/rfc4122">RFC4122</a></li><li>Generate a HS256 JWT, using the <a href="https://github.com/dgrijalva/jwt-go">JWT Go library</a>, which generates JWTs according to <a href="https://tools.ietf.org/html/rfc7519">RFC7519</a><ul><li>This JWT has 3 claims:<ol><li><code>id</code>: the UUID assigned to that entity</li><li><code>iss</code>: the issuer claim (as defined by <a href="https://tools.ietf.org/html/rfc7519">RFC7519</a>)</li><li><code>exp</code>: the expiry of the token, set 24 hours in the future from the current time (again, as defined in <a href="https://tools.ietf.org/html/rfc7519">RFC7519</a>)</li></ol></li></ul></li></ul><p>These same steps are applied when logging in, except for the additional step where the stored hashed and salted password is compared against the provided password.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="making-a-request-to-another-service"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#making-a-request-to-another-service" title="Direct link to heading">#</a>Making a Request to Another Service</h4><p>Upon making a request to a service other than <code>Auth</code>, the following steps are taken before a request is executed:</p><ul><li>Kong validates that a JWT is included with the request, under the <code>Authorization</code> header, with the prefix <code>Bearer</code>, otherwise returns a 401 Unauthorized response</li><li>Kong validates the JWT comparing the <code>iss</code> claim against the known secret, otherwise returns a 401 Unauthorized response</li><li>Kong validates the JWT has not yet expired, otherwise returns a 401 Unauthorized response</li></ul><p>After this, Kong forwards the request to the necessary service.
This service will then extract the UUID from the <code>id</code> claim in this token and use it to associate any entity created with that specific UUID.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="future-plans"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#future-plans" title="Direct link to heading">#</a>Future Plans</h2><p>Obviously this does not provide a solution for every possible authentication scenario, so in the future we plan to:</p><ul><li>Expand from email authentication to include usernames, OAuth and social logins</li><li>Include a refresh token in the register or login response, removing the need to make the user sign in every 24 hours</li><li>Allow for more configuration of JWTs, defining custom claims or varying expiry times</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/TempleEight/temple-docs/edit/master/TempleEight/docs/guide/authentication.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/temple-docs/docs/guide/value-annotations"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Value Annotations</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/temple-docs/docs/guide/access-control"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Access Control »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#adding-authentication-to-your-project" class="contents__link">Adding Authentication to Your Project</a></li><li><a href="#testing-the-authentication-changes" class="contents__link">Testing the Authentication Changes</a></li><li><a href="#registration-and-login" class="contents__link">Registration and Login</a><ul><li><a href="#registration" class="contents__link">Registration</a></li><li><a href="#login" class="contents__link">Login</a></li></ul></li><li><a href="#authenticating-requests-to-other-services" class="contents__link">Authenticating Requests to Other Services</a></li><li><a href="#services-with-auth-metadata" class="contents__link">Services with <code>#auth</code> Metadata</a></li><li><a href="#how-authentication-is-implemented" class="contents__link">How Authentication is Implemented</a></li><li><a href="#future-plans" class="contents__link">Future Plans</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center">Copyright © 2020 TempleEight. Built with Docusaurus.</div></div></footer>
</div>

<script src="/temple-docs/styles.c7e2f16c.js"></script>

<script src="/temple-docs/runtime~main.9c476fb3.js"></script>

<script src="/temple-docs/main.110e30eb.js"></script>

<script src="/temple-docs/1.2506e489.js"></script>

<script src="/temple-docs/30.59f22270.js"></script>

<script src="/temple-docs/35dd2a9b.51c3b611.js"></script>

<script src="/temple-docs/17896441.ac4bbb10.js"></script>

<script src="/temple-docs/24b97b37.144de688.js"></script>


</body>
</html>