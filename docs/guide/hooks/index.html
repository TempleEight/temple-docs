<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">


<title data-react-helmet="true">Business Logic &amp; Hooks | Temple</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Business Logic &amp; Hooks | Temple"><meta data-react-helmet="true" name="description" content="We know that the code generated by Temple won&#x27;t necessarily satisfy every use case."><meta data-react-helmet="true" property="og:description" content="We know that the code generated by Temple won&#x27;t necessarily satisfy every use case."><meta data-react-helmet="true" property="og:url" content="https://templeeight.github.io/temple-docs//temple-docs/docs/guide/hooks">

<link data-react-helmet="true" rel="shortcut icon" href="/temple-docs/img/favicon.ico">


<link rel="stylesheet" href="/temple-docs/styles.93060151.css">


<link rel="preload" href="/temple-docs/styles.c62b851f.js" as="script">

<link rel="preload" href="/temple-docs/runtime~main.8191c14e.js" as="script">

<link rel="preload" href="/temple-docs/main.ece8add9.js" as="script">

<link rel="preload" href="/temple-docs/1.dfbd7593.js" as="script">

<link rel="preload" href="/temple-docs/2.b044f527.js" as="script">

<link rel="preload" href="/temple-docs/35.90e0e044.js" as="script">

<link rel="preload" href="/temple-docs/35dd2a9b.ec8dfa91.js" as="script">

<link rel="preload" href="/temple-docs/17896441.6894cf81.js" as="script">

<link rel="preload" href="/temple-docs/72c9b8f6.5ba654a6.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/temple-docs/"><img class="navbar__logo" src="/temple-docs/img/temple.svg" alt="Temple Logo"><strong class="navbar__title">Temple</strong></a><a class="navbar__item navbar__link" href="/temple-docs/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/TempleEight/temple" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/temple-docs/"><img class="navbar__logo" src="/temple-docs/img/temple.svg" alt="Temple Logo"><strong class="navbar__title">Temple</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/introduction">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/TempleEight/temple" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/access-control">Access Control</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/adding-dao-functions">Adding DAO Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/adding-endpoints">Adding Endpoints</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/authentication">Authentication</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/enumeration">Enumeration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/foreign-keys">Foreign Keys &amp; Inter-Service Communication</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/temple-docs/docs/guide/hooks">Business Logic &amp; Hooks</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/omitting-endpoints">Omitting Endpoints</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/open-api">OpenAPI Generation</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/orchestration">Orchestration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/regeneration">Regeneration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/temple-test">Temple Test</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/value-constraints">Value Constraints</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Generated Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/arch/system">System Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/arch/service">Service Architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/templefile-spec">Templefile Specification</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/templefile-primitives">Templefile Primitives</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Example Templefiles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/airbnb">Airbnb</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/amazon">Amazon</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/deliveroo">Deliveroo</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/five-a-side">5-a-Side</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/lockdown-shopping">Lockdown Shopping</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Business Logic &amp; Hooks</h1></header><div class="markdown"><p>We know that the code generated by Temple won&#x27;t necessarily satisfy every use case.
That&#x27;s why we made it easy to modify and extend the application logic, without sacrificing the ability to regenerate code after.
This short guide will walk you through how to add custom business logic to your application.
We&#x27;ll be using the <code>ExampleProject</code> from the <a href="/temple-docs/docs/getting-started">Getting Started</a> guide, and we&#x27;ll assume you have a basic familiarity with Go syntax.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="adding-custom-logic"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-custom-logic" title="Direct link to heading">#</a>Adding custom logic</h2><p>In the <code>example-service</code> directory, you&#x27;ll find the following files and folders:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">~/Documents/temple-tutorial ❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> -1 example-service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Dockerfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">config.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dao</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">example-service.go</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">go.mod</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hook.go</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">setup.go</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">util</span></div></div></div></div></div><p>We&#x27;re most interested in <code>setup.go</code> for this guide, which is where you can add additional logic that won&#x27;t be lost if you need to regenerate your Templefile.</p><p>This file will start off looking fairly empty:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Add user defined code here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>The <code>setup</code> method defined on <code>env</code> here is invoked before the HTTP server is started.
It gives you, the developer, the opportunity to:</p><ul><li>register hooks, to be executed before or after any database calls</li><li>register new endpoints with the router</li></ul><p>Hooks provide an interface for you to define custom logic that is executed before or after a specific database interaction.
This may include logic for additional validation of request parameters or providing values to be stored that are not included in the request (see <a href="/temple-docs/docs/guide/value-constraints">Value Constraints</a> for more on this).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="registering-a-hook"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#registering-a-hook" title="Direct link to heading">#</a>Registering a hook</h2><p>Within the <code>env</code> object that the <code>setup</code> method is defined on, you will find an attribute called <code>hook</code>.
Hook is a struct that is defined in <code>hook.go</code>, which defines two methods for each endpoint. These are named <code>Before&lt;endpoint&gt;</code> and <code>After&lt;endpoint&gt;</code>, where <code>&lt;endpoint&gt;</code> may be any one of <code>Create</code>, <code>Read</code>, <code>Update</code>, <code>Delete</code>, <code>List</code> or <code>Identify</code>.
More information on these endpoints can be found in <a href="/temple-docs/docs/arch/service">Service Architecture</a>.</p><p>For our example project, the two methods for the <code>Create</code> endpoint are as follows:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">BeforeCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hook </span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req createExampleServiceRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">h </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">AfterCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hook </span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> exampleService </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ExampleService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>By defining a function that matches the argument type defined here, then passing it to the function, we are able to execute arbitrary code before or after the datastore interaction for each endpoint.
The types of each hook vary, depending on the operation they are defined for.
For example, where a request body is not provided, such as in a GET request, the <code>req</code> argument is omitted from the hook.</p><p>If we modify our <code>setup.go</code> to include a new function called <code>ourCustomHook</code>, where the arguments to the function match those for the <code>BeforeCreate</code> argument, we can register a new hook that will be invoked every time a new create request is issued.</p><p>Our code will now read:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">BeforeCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req createExampleServiceRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modifying-the-dao-request"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modifying-the-dao-request" title="Direct link to heading">#</a>Modifying the DAO request</h2><p>Now that we have defined our custom hook, we can start populating it with additional logic.
To start, we will show how you can modify the DAO request.
The DAO provides a common interface to access a backing store, without directly exposing the implementation details of doing so.
More information about this can be found in <a href="/temple-docs/docs/arch/service">Service Architecture</a>.</p><p>The custom hook we defined takes 3 parameters:</p><ul><li>the environment, <code>env</code></li><li>the request provided by the user, <code>req</code></li><li>the input to the datastore request, <code>input</code></li></ul><p>The input object is passed as a pointer, which gets directly passed to the DAO after the hook invocation and will be used as the query for the datastore.
This means if we update any attributes of this object, the data store call will be updated too.
In the following example, we modify all <code>Create</code> requests to the datastore so that each <code>foo</code> property contains the string &quot;Hello, World!&quot;.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">BeforeCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req createExampleServiceRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world!&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>If we perform some example requests, we see that our hook updates the object that is stored, irrespective of what was passed in the request:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Create a new object</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;abcd&quot;, &quot;bar&quot;: 10}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;43cc65f5-823c-11ea-9dc4-0242ac180003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world!&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Retrieve that same object </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X GET </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service/43cc65f5-823c-11ea-9dc4-0242ac180003</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;43cc65f5-823c-11ea-9dc4-0242ac180003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world!&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conditionally-updating-the-datastore-input"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conditionally-updating-the-datastore-input" title="Direct link to heading">#</a>Conditionally updating the datastore input</h2><p>As well as updating the datastore request, we could also use the user&#x27;s request to conditionally update certain fields:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">BeforeCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req createExampleServiceRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bar </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world!&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>This will only update the value of <code>Foo</code> if the value 5 is passed for bar: </p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Create a new object where Bar != 5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;abcd&quot;, &quot;bar&quot;: 10}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;e8e2e06e-823c-11ea-84ea-0242ac170003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;abcd&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Create a new object where Bar == 5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;abcd&quot;, &quot;bar&quot;: 5}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;f244e8f0-823c-11ea-84ea-0242ac170003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world!&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modifying-the-response-to-the-client"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modifying-the-response-to-the-client" title="Direct link to heading">#</a>Modifying the response to the client</h2><p>As well as creating a hook that is invoked before the datastore call, we are able to define a hook that is invoked after the datastore call.
For the same <code>ExampleService</code> as the previous examples, a hook invoked after creating an object would look like:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">AfterCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomAfterHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomAfterHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> exampleService </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ExampleService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>There are only two arguments to this function:</p><ul><li>the environment, <code>env</code></li><li>the newly created object, <code>exampleService</code></li></ul><p>We are able to modify the object that has just been created, before it is returned to the client, by updating the attributes of the object <code>exampleService</code>:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">AfterCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomAfterHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomAfterHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> exampleService </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ExampleService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exampleService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bar </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Since this only modifies the response to the client, and not what&#x27;s stored in the datastore, the value will not be modified in any subsequent GET requests:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Create a new object</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;abcd&quot;, &quot;bar&quot;: 10}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;12bff66e-8243-11ea-9908-0242ac180003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;abcd&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Retrieve that same object</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X GET </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service/12bff66e-8243-11ea-9908-0242ac180003</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;12bff66e-8243-11ea-9908-0242ac180003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;abcd&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="making-additional-dao-calls"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#making-additional-dao-calls" title="Direct link to heading">#</a>Making additional DAO calls</h2><p>One thing we have not yet discussed is the <code>env</code> argument to each of the hooks.
The environment gives you access to the DAO as well as methods for accessing cross service communication.</p><p>This means you can perform additional database requests as part of your <code>Before</code> or <code>After</code> hook.</p><p>These can include the predefined database calls, or your own.
For more information on this, see <a href="/temple-docs/docs/guide/adding-dao-functions">adding DAO functions</a>.</p><p>For example, before updating a given entry, you may want to check what is already stored, and modify the update request accordingly:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">BeforeUpdate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomBeforeUpdateHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomBeforeUpdateHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req updateExampleServiceRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">UpdateExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    current</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ReadExampleService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ReadExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Modify the update query if what is currently stored is &gt; 10</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> current</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bar </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bar </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> current</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bar</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="aborting-requests"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#aborting-requests" title="Direct link to heading">#</a>Aborting Requests</h2><p>Finally, Hooks give you the ability to abort requests early, by returning a <code>HookError</code> from the hook.</p><p>For example, we could use this to disallow any requests where the value of <code>Bar</code> is greater than 10:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;errors&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/gorilla/mux&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;github.com/temple/tutorial/example-service/dao&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">router </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">mux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Router</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">BeforeCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ourCustomBeforeHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> req createExampleServiceRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> input </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateExampleServiceInput</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">HookError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bar </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">HookError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            statusCode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">StatusBadRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">      errors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;The value of bar must be less than or equal to 10&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Running some example requests:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># An example request where bar &lt;= 10</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;abcd&quot;, &quot;bar&quot;: 5}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1ee638c1-8246-11ea-aef0-0242ac180003&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;abcd&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token plain">:5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># An example request where bar &gt; 10</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ </span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$KONG_ENTRY</span><span class="token plain">/api/example-service -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{&quot;foo&quot;: &quot;abcd&quot;, &quot;bar&quot;: 15}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;error&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;The value of bar must be less than or equal to 10&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/TempleEight/temple-docs/edit/master/TempleEight/docs/guide/hooks.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/temple-docs/docs/guide/foreign-keys"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Foreign Keys &amp; Inter-Service Communication</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/temple-docs/docs/guide/metrics"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Metrics »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#adding-custom-logic" class="contents__link">Adding custom logic</a></li><li><a href="#registering-a-hook" class="contents__link">Registering a hook</a></li><li><a href="#modifying-the-dao-request" class="contents__link">Modifying the DAO request</a></li><li><a href="#conditionally-updating-the-datastore-input" class="contents__link">Conditionally updating the datastore input</a></li><li><a href="#modifying-the-response-to-the-client" class="contents__link">Modifying the response to the client</a></li><li><a href="#making-additional-dao-calls" class="contents__link">Making additional DAO calls</a></li><li><a href="#aborting-requests" class="contents__link">Aborting Requests</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright © 2020 TempleEight. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/temple-docs/styles.c62b851f.js"></script>

<script src="/temple-docs/runtime~main.8191c14e.js"></script>

<script src="/temple-docs/main.ece8add9.js"></script>

<script src="/temple-docs/1.dfbd7593.js"></script>

<script src="/temple-docs/2.b044f527.js"></script>

<script src="/temple-docs/35.90e0e044.js"></script>

<script src="/temple-docs/35dd2a9b.ec8dfa91.js"></script>

<script src="/temple-docs/17896441.6894cf81.js"></script>

<script src="/temple-docs/72c9b8f6.5ba654a6.js"></script>


</body>
</html>