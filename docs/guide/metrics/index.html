<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Metrics</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Temple Â· Generate microservice systems at lightning speed"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:url" content="https://templeeight.github.io/temple-docs//temple-docs/docs/guide/metrics">

<link data-react-helmet="true" rel="shortcut icon" href="/temple-docs/img/favicon.ico">


<link rel="stylesheet" href="/temple-docs/styles.d71321c5.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/temple-docs/"><img class="navbar__logo" src="/temple-docs/img/temple.svg" alt="Temple Logo"><strong>Temple</strong></a><a class="navbar__item navbar__link" href="/temple-docs/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/TempleEight/temple">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/temple-docs/"><img class="navbar__logo" src="/temple-docs/img/temple.svg" alt="Temple Logo"><strong>Temple</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/TempleEight/temple">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/access-control">Access Control</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/adding-dao-functions">Adding DAO Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/adding-endpoints">Adding Endpoints</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/authentication">Authentication</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/enumeration">Enumeration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/foreign-keys">Foreign Keys &amp; Inter-Service Communication</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/hooks">Business Logic &amp; Hooks</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/temple-docs/docs/guide/metrics">Metrics</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/omitting-endpoints">Omitting Endpoints</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/open-api">OpenAPI Generation</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/orchestration">Orchestration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/regeneration">Regeneration</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/temple-test">Temple Test</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/value-annotations">Value Annotations</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/guide/value-constraints">Value Constraints</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Generated Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/arch/system">System Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/arch/service">Service Architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/templefile-spec">Templefile Specification</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/templefile-primitives">Templefile Primitives</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Example Templefiles</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/airbnb">Airbnb</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/amazon">Amazon</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/deliveroo">Deliveroo</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/five-a-side">5-a-Side</a></li><li class="menu__list-item"><a class="menu__link" href="/temple-docs/docs/reference/example-templefiles/lockdown-shopping">Lockdown Shopping</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Metrics</h1></header><div class="markdown"><p>Being able to extract meaningful metrics is a crucial part of any microservice-oriented system.
That&#x27;s why we&#x27;ve made it easy to add metrics to your Temple project, for you to view quantitative data about successes and failures, as well as latency information.</p><p>For this guide, we&#x27;ll be using the project from the <a href="../getting-started">Getting Started</a> guide as our starting point.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="adding-metrics-to-your-project"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-metrics-to-your-project" title="Direct link to heading">#</a>Adding Metrics to Your Project</h2><p>To add metrics to your Temple project, you just need to add a single metadata item to your <code>project</code>:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-templefile codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExampleProject: project {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #language(go);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #database(postgres);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  #provider(dockerCompose);</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">  #metrics(prometheus);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ExampleService: service {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  foo: string;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bar: int;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>This indicates that each service in the project will export some metrics to <a href="https://prometheus.io">Prometheus</a>, a popular open source monitoring system.
Prometheus data is then exposed for visualisation with <a href="https://grafana.com/grafana/">Grafana</a>.
This is currently the only supported metrics configuration that Temple supports.</p><p>After regenerating your project, you&#x27;ll find several new folders have appeared:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ grafana</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â  â””â”€â”€ provisioning</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â      â”œâ”€â”€ dashboards</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ dashboards.yml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â      â”‚Â Â  â””â”€â”€ example-service.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â      â””â”€â”€ datasources</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â          â””â”€â”€ datasource.yml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â””â”€â”€ prometheus</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    â””â”€â”€ prometheus.yml</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>These two folders provide the configuration for Grafana and Prometheus, and are mounted into their associated Docker container when it is started.
More information about these files can be found in the <a href="https://grafana.com/docs/grafana/latest/reference/dashboard/">Grafana Documentation</a> and <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Prometheus Documentation</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="viewing-metrics"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#viewing-metrics" title="Direct link to heading">#</a>Viewing Metrics</h2><p>Viewing metrics from your service is very straight forward, first spin up your infrastructure using the provided deployment script:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">â¯â¯â¯ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> deploy.sh</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Then, open <code>localhost:3000</code> in your browser.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>If you&#x27;re using Kubernetes instead of Docker Compose, you&#x27;ll want to run the following command, which will open the Grafana dashboard in your browser:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">â¯â¯â¯ minikube service grafana</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre></div></div><p>This should present you with the Grafana login window.
The default login is <code>admin</code> for both the username and password:</p><img alt="Grafana Login" src="/temple-docs/img/grafana-login.png"><p>You may be prompted to change the default password, in which case set it to something memorable.</p><p>After logging in, you&#x27;ll want to head to the left-side bar, and select Dashboards &gt; Manage Dashboards</p><p align="center"><img alt="Grafana Dashboard Menu" src="/temple-docs/img/grafana-dashboard-menu.png" width="25%"></p><p>This should present you with a list of dashboards: namely one for each service.
Right now we only have one dashboard for our <code>ExampleService</code>:</p><img alt="Grafana Dashboard Manager" src="/temple-docs/img/grafana-dashboard-manager.png"><p>Let&#x27;s open it up and see what panels are generated:</p><img alt="Grafana Empty Dashboard" src="/temple-docs/img/grafana-empty-panels.png"><p>You&#x27;ll see there are 8 panels here: two for each endpoint.
We use one panel to show successful and failed requests, and the other to show latency of database queries broken down into 50th, 90th, 95th and 99th percentiles.
However, we currently don&#x27;t have any data to show in this dashboard, because no tests have been made. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="automating-requests"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#automating-requests" title="Direct link to heading">#</a>Automating Requests</h3><p>You could now start making some manual requests to your service and see the associated metrics pop up on each panel.
However, we&#x27;ve built an automated request tool directly into Temple, allowing you to mock requests from end users.</p><p>To do this, we&#x27;re going to be using the <code>temple test</code> command.
As explained in the <a href="temple-test">Temple Test</a> guide, <code>temple test</code> has two main operating modes: </p><ol><li>Testing including spinning up and then destroying the associated infrastructure</li><li>Testing without touching the infrastructure</li></ol><p>In this guide we&#x27;re going to be using the second mode.</p><p>To invoke this, we&#x27;re going to use the following command:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-bash codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">â¯â¯â¯ temple </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> --testOnly example.temple</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ğŸ§ª Testing ExampleService </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    âœ… ExampleService create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    âœ… ExampleService </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">read</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    âœ… ExampleService update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    âœ… ExampleService delete</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ğŸ‰ Everything passed</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>You can run that as many times as you&#x27;d like, and after a few seconds you should start to see metrics appearing on the dashboard!</p><img alt="Grafana Metrics" src="/temple-docs/img/grafana-metrics.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="under-the-hood-of-metrics"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#under-the-hood-of-metrics" title="Direct link to heading">#</a>Under the Hood of Metrics</h2><p>There&#x27;s a lot going on behind the scenes to make metrics work this seamlessly:</p><ul><li>Each Go service starts an additional HTTP server that exposes Prometheus metrics</li><li>Prometheus periodically scrapes each HTTP endpoint for the data, and forwards this to Grafana</li><li>Grafana then displays this data using queries defined in <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="prometheus-metrics"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#prometheus-metrics" title="Direct link to heading">#</a>Prometheus Metrics</h3><p>We expose 3 different types of metrics from each service:</p><ol><li>A counter of successful requests</li></ol><ul><li>This is named <code>${service}_request_success_total</code></li><li>The request type is provided as a label named <code>request_type</code>, so that you can both aggregate and split all successful requests as desired</li></ul><ol start="2"><li>A counter of failed requests</li></ol><ul><li>This is named <code>${service}_request_failure_total</code></li><li>The request type is provided as a label named <code>request_type</code>, so that you can both aggregate and split all failed requests as desired</li></ul><ol start="3"><li>A summary of database request durations</li></ol><ul><li>This is named <code>${service}_database_request_seconds</code></li><li>The query type is provided as a label named <code>query_type</code>, so that you can both aggregate and split all database requests as desired</li></ul><p>The exposed Prometheus counters for your <code>ExampleService</code> can be found in <code>example-service/metric/metrics.go</code>.</p><p>The underlying <code>PromQL</code> queries in Grafana display this data by considering the rate of change over the last 5 minutes.
For example, the successful create requests are plotted as:</p><pre class="mdxCodeBlock_iHAB"><div><pre class="prism-code language-promql codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rate(exampleservice_request_success_total{request_type=&quot;create&quot;}[5m])</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/TempleEight/temple-docs/edit/master/TempleEight/docs/guide/metrics.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/temple-docs/docs/guide/hooks"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">Â« Business Logic &amp; Hooks</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/temple-docs/docs/guide/omitting-endpoints"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Omitting Endpoints Â»</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#adding-metrics-to-your-project" class="contents__link">Adding Metrics to Your Project</a></li><li><a href="#viewing-metrics" class="contents__link">Viewing Metrics</a><ul><li><a href="#automating-requests" class="contents__link">Automating Requests</a></li></ul></li><li><a href="#under-the-hood-of-metrics" class="contents__link">Under the Hood of Metrics</a><ul><li><a href="#prometheus-metrics" class="contents__link">Prometheus Metrics</a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center">Copyright Â© 2020 TempleEight. Built with Docusaurus.</div></div></footer>
</div>

<script src="/temple-docs/styles.413b178a.js"></script>

<script src="/temple-docs/runtime~main.f03f045a.js"></script>

<script src="/temple-docs/main.b6ed20fd.js"></script>

<script src="/temple-docs/1.ea37e5bd.js"></script>

<script src="/temple-docs/35.08f256c8.js"></script>

<script src="/temple-docs/35dd2a9b.8f670a51.js"></script>

<script src="/temple-docs/17896441.88cf6f8b.js"></script>

<script src="/temple-docs/853ef3a9.a91d8fb4.js"></script>


</body>
</html>